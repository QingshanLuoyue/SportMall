/**
 *
 * 轮播效果
 * 详细用法请参考：http://v3.spice.lh/javascript/kvscroll
 * 如果链接无法访问，请联系QQ：1515110755 或 RTX：hong.liang
 *
 * @ author Razy
 * @ version 1.0
 *
 */
!function(a,b,c){"object"==typeof module&&"object"==typeof module.exports?module.exports=b(a):a.spice[c]=b(a)}(jQuery,function(a){function b(b,c){if(!b||a.isPlainObject(b))return!1;var d=[];return a(b).each(function(b,e){var f=a(e),g=f.data("spice.kvScroll");g&&g.destroy(),f.data("spice.kvScroll",g=new j(f,c)),d.push(g)}),d}var c=a.spice.android,d=a.spice.hasTouch,e=d?"touchstart.kvScroll":"mousedown.kvScroll",f=d?"touchmove.kvScroll":"mousemove.kvScroll",g=d?"touchend.kvScroll touchcancel.kvScroll":"mouseleave.kvScroll",h={type:"scroll",axis:"x",easing:"normal",autoPlay:!0,time:3e3,loop:!0,moveNum:1,stopElem:null,callBack:null,dot:{style:null,dotsEvent:"tap"},btn:!0},i={fade:function(b,c){var d=b.opt,e=(b.ul,b.li);e.not(":eq("+c+")").hide(),b.curPage=c,b.initDotsAClass(b.curPage),i.disabledBtn(b),e.eq(c).fadeIn(d.easing,function(){!b.isHover&&b.addInterval(),d.callBack&&a.isFunction(d.callBack)&&d.callBack(b.curPage,b)})},scroll:function(b,c){var d=b.opt,e=b.ul,f=(b.li,{}),g=b.getLiH();"y"==d.axis?f.marginTop="-"+c*g+"px":f.marginLeft="-"+c*parseInt(e.parent().width())+"px",b.curPage=c,"scroll-loop"==d.type&&d.loop&&(0==c?b.curPage=b.liLength-2:c==b.maxPage?b.curPage=1:b.curPage=c),b.initDotsAClass(b.curPage-("scroll-loop"==d.type&&d.loop?1:0)),i.disabledBtn(b),e.animate(f,d.easing,function(){"scroll-loop"==d.type&&d.loop&&(0==c?("y"==d.axis?f.marginTop="-"+(b.liLength-2)*g+"px":f.marginLeft="-"+(b.liLength-2)*parseInt(e.parent().width())+"px",e.css(f)):c==b.maxPage&&("y"==d.axis?f.marginTop="-"+g+"px":f.marginLeft="-"+parseInt(e.parent().width())+"px",e.css(f))),!b.isHover&&b.addInterval(),d.callBack&&a.isFunction(d.callBack)&&d.callBack(c,b)})},"scroll-loop":function(a,b){i.scroll(a,b)},gallery:function(b,c){var d=b.opt,e=b.ul,f=(b.li,{}),g=-c*("y"==d.axis?b.getLiH():b.getLiW())*b.moveNum;g=g<b.galleryMaxMG?b.galleryMaxMG:g,f["y"==d.axis?"marginTop":"marginLeft"]=g,i.disabledBtn(b),e.animate(f,d.easing,function(){b.curPage=c,!b.isHover&&b.addInterval(),d.callBack&&a.isFunction(d.callBack)&&d.callBack(c,b)})},"gallery-loop":function(a,b,c){if(d)return i.gallery(a,b),!1;var e=a.opt,f=a.ul,g=a.li,h=a.getLiW(),j=-h*a.moveNum,k=a.getUlMl()+("prev"==c?-j:j),l={marginLeft:k};"prev"==c?a.getUlMl()>-a.getLiW()*a.moveNum&&(f.css({marginLeft:(a.getUlMl()/h-g.length/3)*h}),l.marginLeft=a.getUlMl()-j):a.getUlMl()<-a.getLiW()*(g.length/3-1)&&(f.css({marginLeft:(a.getUlMl()/h+g.length/3)*h}),l.marginLeft=a.getUlMl()+j),i.disabledBtn(a),f.animate(l,e.easing,function(){})},sx:0,sy:0,mx:0,my:0,sMl:0,sMt:0,sMoveTime:0,eMoveTime:0,scrollHover:function(b){var h=b.opt,j=b.elem;d?j=j.find("ul:eq(0)"):j.off("mouseenter.pcKvScroll").off("mouseleave.pcKvScroll").on("mouseenter.pcKvScroll",function(){b.removeInterval(),a("body").addClass("noSelect")}).on("mouseleave.pcKvScroll",function(){b.addInterval(),a("body").removeClass("noSelect")}),j.off(".kvScroll").on(e,function(e){if(j.off(f).off(g),!b.isNotAnimate())return!1;b.removeInterval(),b.isHover=!0;var k=a.spice.getEventXY(e);i.sMl=b.getUlMl(),i.sMt=b.getUlMt(),i.sx=k.x,i.sy=k.y,i.mx=0,i.my=0,i.sMoveTime=(new Date).getTime(),j.on(f,function(c){if(b.removeInterval(),b.isHover=!0,d&&b.isStopElem()){var e=a.spice.getEventXY(c);if(i.mx=e.x,i.my=e.y,"y"==h.axis?c.preventDefault():Math.abs(i.mx-i.sx)>8&&c.preventDefault(),"fade"!=h.type){if("y"==h.axis)var f=i.my-(i.sy-i.sMt);else var f=i.mx-(i.sx-i.sMl);var g={};g["y"==h.axis?"marginTop":"marginLeft"]=f,"scroll"==h.type||"scroll-loop"==h.type&&!h.loop?f>0?(g["y"==h.axis?"marginTop":"marginLeft"]=Math.abs(f)/3,b.ul.css(g)):f<-b.maxPage*b.li.width()&&"y"!=h.axis?b.ul.css({marginLeft:(i.mx-(i.sx-i.sMl)-i.sMl)/3+i.sMl}):f<-b.maxPage*b.li.height()&&"y"==h.axis?b.ul.css({marginTop:(i.my-(i.sy-i.sMt)-i.sMt)/3+i.sMt}):b.ul.css(g):"gallery"==h.type||"gallery-loop"==h.type?f>0?(g["y"==h.axis?"marginTop":"marginLeft"]=Math.abs(f)/3,b.ul.css(g)):f<b.galleryMaxMG&&"y"!=h.axis?b.ul.css({marginLeft:(f-b.galleryMaxMG)/3+b.galleryMaxMG}):f<-b.maxPage*b.li.height()&&"y"==h.axis?b.ul.css({marginTop:(f-b.galleryMaxMG)/3+b.galleryMaxMG}):b.ul.css(g):b.ul.css(g)}}}).on(g,function(e){if(b.addInterval(),b.isHover=!1,d&&b.isStopElem())if("scroll"==h.type||"scroll-loop"==h.type){var f=b.getUlMl(),g=b.getUlMt(),j=b.getLiW(),k=b.getLiH();(Math.abs(i.sMl-f)>(c?10:25)||Math.abs(i.sMt-g)>(c?10:25))&&("y"==h.axis?b.curPage=Math.ceil(Math.abs(g/k))-(i.sMt>g?0:1):b.curPage=Math.ceil(Math.abs(f/j))-(i.sMl>f?0:1),b.curPage=b.curPage>b.maxPage?b.maxPage:b.curPage),i.mx&&b.scroller(b.curPage)}else if("fade"==h.type)0==i.mx?b.curPage=b.curPage:Math.abs(i.sx-i.mx)>(c?10:25)&&(b.curPage=i.sx>i.mx?b.curPage+1:b.curPage-1),b.curPage<0&&(b.curPage=h.loop?b.maxPage:0),b.curPage>b.maxPage&&(b.curPage=h.loop?0:b.maxPage),b.scroller(b.curPage);else if("gallery"==h.type||"gallery-loop"==h.type){var l=a.spice.getEventXY(e);if(i.eMoveTime=(new Date).getTime(),"y"==h.axis)var m=(l.y-i.sy)/(i.eMoveTime-i.sMoveTime);else var m=(l.x-i.sx)/(i.eMoveTime-i.sMoveTime);!function(c,d,e){function f(){var k=(new Date).getTime(),l=k-d,m=c+l*j,n=(c+m)/2*l,o={},p=0;if(p="y"==h.axis?b.getUlMt():b.getUlMl(),g*m>0)return"y"==h.axis?b.curPage=parseInt(Math.abs(p/b.getLiH())):b.curPage=parseInt(Math.abs(p/b.getLiW())),i.galleryDisabledBtn(b,p),void(h.callBack&&a.isFunction(h.callBack)&&h.callBack(b.curPage,b));var q=e+n;return q<=b.galleryMaxMG?(p=b.galleryMaxMG,o["y"==h.axis?"marginTop":"marginLeft"]=p,i.galleryDisabledBtn(b,p),b.ul.animate(o,"normal",function(){h.callBack&&a.isFunction(h.callBack)&&h.callBack(b.curPage,b)}),!1):q>=0?(p=0,o["y"==h.axis?"marginTop":"marginLeft"]=p,i.galleryDisabledBtn(b,p),b.ul.animate(o,"normal",function(){h.callBack&&a.isFunction(h.callBack)&&h.callBack(b.curPage,b)}),!1):(o["y"==h.axis?"marginTop":"marginLeft"]=q,b.ul.css(o),void setTimeout(f,10))}var g=c>0?-1:1,j=.005*g;f()}(m,i.eMoveTime,"y"==h.axis?b.getUlMt():b.getUlMl())}})})},getDotHtml:function(b,c){var d=c.opt.dot,e=d.style;if(("gallery"!=c.opt.type||"gallery-loop"!=c.opt.type)&&e&&b>1){for(var f='<div class="scroll-dots">',g=1;b>=g;g++)"dot"==e?f+="<a"+(1==g?' class="active"':"")+">"+g+"<i></i></a>":"text"==e?f+='<a class="dots-text'+(1==g?" active":"")+'">'+(c.li.eq(g-1).attr("data-title")||g)+"<i></i></a>":e&&a.isFunction(e)&&(f+=e(c.li.eq(g-1))||"");f+="</div>",a(".scroll-dots",c.elem).remove(),c.elem.append(f),a(".scroll-dots > *:eq(0)",c.elem).addClass("active")}},disabledBtn:function(a){if(!a.opt.loop){var b=a.btnPrev,c=a.btnNext,d=a.maxPage,e=a.curPage;e>=d&&(b.removeClass("is-disabled"),c.addClass("is-disabled")),0==e&&(b.addClass("is-disabled"),c.removeClass("is-disabled")),e>0&&d>e&&(b.removeClass("is-disabled"),c.removeClass("is-disabled"))}},galleryDisabledBtn:function(a,b){var c=a.btnPrev,d=a.btnNext,e=a.galleryMaxMG;0>b?(c.removeClass("is-disabled"),b>e?d.removeClass("is-disabled"):d.addClass("is-disabled")):(c.addClass("is-disabled"),d.removeClass("is-disabled"))}},j=function(b,c){var d=this;return d.opt=a.extend({},h,c),d.elem=b,i[d.opt.type]?(d.btnPrev=a(".scroll-btn-prev",b),d.btnNext=a(".scroll-btn-next",b),d.ul=a("ul:eq(0)",b),void d.init()):!1};return j.prototype={init:function(){var b=this,c=b.opt,e=b.elem,f=b.ul,g=b.li=a(">li",f);b.curPage=0,b.destroy(),g=b.li=a(">li",f);var h=b.liLength=g.length,j=b.initMG=0;i.getDotHtml(h,b),b.dots=a(".scroll-dots",e),b.dotsA=a("> *",b.dots);var k=function(b){var b=a.Deferred(),c=function(){var c=a("img:eq(0)",g).attr("src");c?a('<img src="'+a("img:eq(0)",g).attr("src")+'">').load(function(){b.resolve()}):b.resolve()};return c(),b.promise()};a.when(k()).done(function(){b.maxPage=h-1;var e=b.getLiH();if("scroll-loop"==c.type&&c.loop&&h>1){var k=g.first().clone(!0).addClass("kvScroll-Clone"),l=g.last().clone(!0).addClass("kvScroll-Clone");f.append(k).prepend(l),h=b.liLength=h+2,j="y"==c.axis?b.initMG=-e+"px":b.initMG=-f.parent().width(),b.maxPage=h-1,b.curPage=1}if("fade"==c.type);else if("gallery"==c.type||"gallery-loop"==c.type){if(b.curPage=0,a(window).on("resize.gallery",function(){if(!b.elem.data("spice.kvScroll"))return!1;var e=b.getLiW(),g=b.getLiH(),j=b.getDivW(),k=b.getDivH();if("gallery-loop"==c.type&&c.loop&&0==a("li.kvScroll-Clone",f).length&&!d){Math.ceil(j/e);if(h*e>j){var l=a(">li:not([class*=kvScroll-Clone])",f);f.append(l.clone(!0).addClass("kvScroll-Clone")).append(l.clone(!0).addClass("kvScroll-Clone"))}}if(j=b.getDivW(),k=b.getDivH(),"y"==c.axis)var m=parseInt(k/g);else var m=parseInt(j/e);b.moveNum=m<c.moveNum?m:c.moveNum,b.maxPage=Math.ceil((h-m)/b.moveNum);var n=0;"y"==c.axis?(b.galleryMaxMG=-g*h+k,n=b.getUlMt()):(b.galleryMaxMG=-e*h+j,n=b.getUlMl()),n<b.galleryMaxMG&&("y"==c.axis?f.css({marginTop:b.galleryMaxMG}):f.css({marginLeft:b.galleryMaxMG})),i.galleryDisabledBtn(b,n)}).trigger("resize.gallery"),b.maxPage<=0)return i.disabledBtn(b),c.callBack&&a.isFunction(c.callBack)&&c.callBack(b.curPage,b),!1}else"y"==c.axis?(a(window).on("resize.scroll",function(){return b.elem.data("spice.kvScroll")?(e=b.getLiH(),void a(".scroller-wrap",b.elem).css({height:e})):!1}).trigger("resize.scroll"),f.css({marginTop:j}),a(">li",f).css({display:"block"})):(f.css({width:100*h+"%",marginLeft:j}),a(">li",f).css({width:100/h+"%"}).css({display:"block"}),a(window).on("resize.scroll",function(){return b.elem.data("spice.kvScroll")?(f.css({marginLeft:100*-b.curPage+"%"}),void f.css({marginLeft:-b.curPage*b.getLiW()+"px"})):!1}));if(b.li=a(">li",f),"y"!=c.axis){var m=("scroll-loop"==b.opt.type&&b.opt.loop?b.li.length-2:b.li.length)*b.dotsA.outerWidth(!0);b.dots.css({width:m,left:"50%",marginLeft:-m/2})}var n='<div class="scroll-btn-prev'+(1>=h||0==b.maxPage||!b.opt.btn?" none":"")+'">									<a><i>'+("y"==c.axis?"&and;":"&lt;")+'</i></a>								</div>								<div class="scroll-btn-next'+(1>=h||0==b.maxPage||!b.opt.btn?" none":"")+'">									<a><i>'+("y"==c.axis?"&or;":"&gt;")+"</i></a>								</div>";b.elem.append(n),b.btnPrev=a(".scroll-btn-prev",b.elem),b.btnNext=a(".scroll-btn-next",b.elem),b.initDotsAClass(0),b.btnNext.off(".kvScroll").on("tap",function(){b.next()}),b.btnPrev.off(".kvScroll").on("tap",function(){b.prev()}),b.dotsA.off(".kvScroll").on(c.dot.dotsEvent||"tap",function(){if(b.isNotAnimate()){var d=b.curPage=a(this).index();b.scroller("scroll-loop"==c.type?d+1:d)}}),b.addInterval(),i.scrollHover(b),i.disabledBtn(b),c.callBack&&a.isFunction(c.callBack)&&c.callBack(b.curPage,b)}).fail(function(){})},next:function(){var a=this;if(a.isNotAnimate()){var b=++a.curPage,c=a.maxPage;b>c&&(b=a.curPage=a.opt.loop?0:c),this.scroller(b,"next")}},prev:function(){var a=this;if(a.isNotAnimate()){var b=--a.curPage,c=a.maxPage;0>b&&(b=a.curPage=a.opt.loop?c:0),this.scroller(b,"prev")}},scroller:function(a,b){var c=this,d=c.opt;c.ul,c.li;c.isNotAnimate()&&(c.removeInterval(),i[d.type](this,a,b))},initDotsAClass:function(b){a(".scroll-dots > *",this.elem).eq(b).addClass("active").siblings().removeClass("active")},isNotAnimate:function(){var b=[this.ul.is(":not(:animated)")];return a.each(this.li,function(c,d){b.push(a(d).is(":not(:animated)"))}),a.inArray(!1,b)<0},addInterval:function(){var a=this;if(!this.isStop){a.removeInterval();var b=setInterval(function(){a.opt.autoPlay&&a.next()},a.opt.time);a.elem.data("interval",b)}},removeInterval:function(){var a=this.elem.data("interval");a&&clearInterval(a)},getLiW:function(){return+this.li.outerWidth(!0)},getLiH:function(){return+this.li.outerHeight(!0)},getDivW:function(){return+a(">div",this.elem).width()},getDivH:function(){return+a(">div",this.elem).height()},getUlMl:function(){return+this.ul.css("marginLeft").replace(/px/gi,"")},getUlMt:function(){return+this.ul.css("marginTop").replace(/px/gi,"")},isStopElem:function(){return d&&this.opt.stopElem?0==a(this.opt.stopElem+":visible",this.li).length:!0},start:function(){this.isStop=!1,this.addInterval()},stop:function(){this.isStop=!0,this.removeInterval()},destroy:function(){this.removeInterval(),this.ul.removeAttr("style"),this.li.removeAttr("style"),a(".scroller-wrap",this.elem).removeAttr("style"),this.li.remove(".kvScroll-Clone"),a(".scroll-dots",this.elem).remove(),a(".scroll-btn-prev",this.elem).remove(),a(".scroll-btn-next",this.elem).remove(),this.btnNext.off(),this.btnPrev.off(),a(".scroll-dots > *",this.elem).off(),this.elem.off(),this.ul.off(),this.elem.removeData("spice.kvScroll")}},b},"kvScroll");